import"./index.css";import{openModal,closeModal}from"../components/modals.js";import{checkInputValidity,hideInputError,toggleButtonState}from"../components/validate.js";import avatarImg from"../images/avatar.jpg";document.getElementById("avatar-img").src=avatarImg;import logoImg from"../images/logo.svg";document.getElementById("logo-img").src=logoImg;import{updateUserInfo,addCard,getUserInfo,getInitialCards,deleteCard,likeCard,unlikeCard,updateUserAvatar}from"../utils/api.js";var cardTemplate=document.querySelector("#card-template").content.querySelector(".card"),cardsContainer=document.querySelector(".places__list"),profilePopup=document.querySelector(".popup_type_edit"),cardPopup=document.querySelector(".popup_type_new-card"),imagePopup=document.querySelector(".popup_type_image"),profileEditButton=document.querySelector(".profile__edit-button"),profileName=document.querySelector(".profile__title"),profileDescription=document.querySelector(".profile__description"),profileFormElement=document.querySelector(".popup_type_edit .popup__form"),nameInput=profileFormElement.querySelector("#popup__input_type_name"),jobInput=profileFormElement.querySelector("#popup__input_type_description");function handleProfileFormSubmit(e){e.preventDefault();var t=profileFormElement.querySelector(".popup__button");renderLoading(!0,t),updateUserInfo(nameInput.value,jobInput.value).then((function(e){profileName.textContent=e.name,profileDescription.textContent=e.about,closeModal(profilePopup)})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){renderLoading(!1,t)}))}profileEditButton.addEventListener("click",(function(){nameInput.value=profileName.textContent,jobInput.value=profileDescription.textContent,checkInputValidity(profileFormElement,nameInput),checkInputValidity(profileFormElement,jobInput);var e=Array.from(profileFormElement.querySelectorAll(".popup__input")),t=profileFormElement.querySelector(".popup__button");toggleButtonState(e,t),openModal(profilePopup)})),profileFormElement.addEventListener("submit",handleProfileFormSubmit),profilePopup.querySelector(".popup__close").addEventListener("click",(function(){closeModal(profilePopup)}));var addCardButton=document.querySelector(".profile__add-button"),cardFormElement=document.querySelector(".popup_type_new-card .popup__form"),cardNameInput=cardFormElement.querySelector(".popup__input_type_card-name"),cardLinkInput=cardFormElement.querySelector(".popup__input_type_url");function handleCardFormSubmit(e){e.preventDefault();var t=cardFormElement.querySelector(".popup__button");renderLoading(!0,t),addCard(cardNameInput.value,cardLinkInput.value).then((function(e){var t=createCard(e,currentUserId);cardsContainer.prepend(t),closeModal(cardPopup),cardFormElement.reset()})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){renderLoading(!1,t)}))}function renderLoading(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";t.textContent=e?r:o}function createCard(e,t){var r=cardTemplate.cloneNode(!0),o=r.querySelector(".card__image"),n=r.querySelector(".card__title"),a=r.querySelector(".card__delete-button"),p=r.querySelector(".card__like-button"),u=r.querySelector(".card__like-count");return o.src=e.link,o.alt=e.name,n.textContent=e.name,u.textContent=e.likes.length,e.owner._id!==t?a.remove():a.addEventListener("click",(function(){deleteCardFromServer(e._id).then((function(){return r.remove()})).catch((function(e){return console.error("Ошибка удаления карточки:",e)}))})),e.likes.some((function(e){return e._id===currentUserId}))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(){p.classList.contains("card__like-button_is-active")?unlikeCard(e._id).then((function(e){p.classList.remove("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка снятия лайка:",e)})):likeCard(e._id).then((function(e){p.classList.add("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка постановки лайка:",e)}))})),o.addEventListener("click",(function(){var t=imagePopup.querySelector(".popup__image"),r=imagePopup.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,r.textContent=e.name,openModal(imagePopup)})),r}function deleteCardFromServer(e){return deleteCard(e)}addCardButton.addEventListener("click",(function(){cardFormElement.reset();var e=cardFormElement.querySelector(".popup__input_type_card-name"),t=cardFormElement.querySelector(".popup__input_type_url");hideInputError(cardFormElement,e),hideInputError(cardFormElement,t);var r=Array.from(cardFormElement.querySelectorAll(".popup__input")),o=cardFormElement.querySelector(".popup__button");toggleButtonState(r,o),openModal(cardPopup)})),cardFormElement.addEventListener("submit",handleCardFormSubmit),cardPopup.querySelector(".popup__close").addEventListener("click",(function(){closeModal(cardPopup)})),imagePopup.querySelector(".popup__close").addEventListener("click",(function(){closeModal(imagePopup)}));var currentUserId="",profileAvatar=document.querySelector(".profile__image"),avatarPopup=document.querySelector(".popup_type_avatar"),avatarForm=avatarPopup.querySelector(".popup__form"),avatarInput=avatarForm.querySelector(".popup__input_type_avatar-link"),avatarSubmitButton=avatarForm.querySelector(".popup__button");function clearValidation(e){e.reset()}getUserInfo().then((function(e){profileName.textContent=e.name,profileDescription.textContent=e.about,document.querySelector("#avatar-img").src=e.avatar,currentUserId=e._id})).catch((function(e){console.error("Ошибка загрузки информации о пользователе:",e)})),profileAvatar.addEventListener("click",(function(){clearValidation(avatarForm),openModal(avatarPopup)})),avatarForm.addEventListener("submit",(function(e){e.preventDefault();var t=avatarForm.querySelector(".popup__button");renderLoading(!0,t);var r=avatarInput.value;updateUserAvatar(r).then((function(e){profileAvatar.src=e.avatar,closeModal(avatarPopup),avatarForm.reset()})).catch((function(e){console.error("Ошибка обновления аватара:",e),alert("Не удалось обновить аватар")})).finally((function(){renderLoading(!1,t)}))})),avatarPopup.querySelector(".popup__close").addEventListener("click",(function(){closeModal(avatarPopup)})),getInitialCards().then((function(e){e.forEach((function(e){var t=createCard(e,currentUserId);cardsContainer.append(t)}))})).catch((function(e){console.error("Ошибка загрузки карточек:",e)}));