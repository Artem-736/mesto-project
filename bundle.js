(()=>{"use strict";var e={};function t(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function o(e,t){var n=e.querySelector("#".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""}function c(e,t){if(t.validity.valid)o(e,t);else{var n=function(e){return e.validity.valueMissing?"Вы пропустили это поле.":e.validity.typeMismatch&&"url"===e.type?"Введите адрес сайта.":e.validity.tooShort?"Минимальное количество символов: ".concat(e.minLength,". Длина текста сейчас: ").concat(e.value.length," символ").concat(1===e.value.length?"":"а","."):e.validationMessage}(t);!function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),r.textContent=n,r.classList.add("popup__input-error_active")}(e,t,n)}}function u(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("popup__button_disabled"),t.disabled=!1):(t.classList.add("popup__button_disabled"),t.disabled=!0)}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&r(e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");u(t,n),t.forEach((function(r){r.addEventListener("input",(function(){c(e,r),u(t,n)}))}))}(e)}));const a=e.p+"6666407ac3aa5af1d5de.jpg",i=e.p+"fc3e6875d825f899a98d.svg";var p={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2019b335-80c7-44ca-8b1a-9a47dc8dca6a","Content-Type":"application/json"}};document.getElementById("avatar-img").src=a,document.getElementById("logo-img").src=i;var s=document.querySelector("#card-template").content.querySelector(".card"),l=document.querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),y=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),h=document.querySelector(".popup_type_edit .popup__form"),S=h.querySelector("#popup__input_type_name"),b=h.querySelector("#popup__input_type_description");y.addEventListener("click",(function(){S.value=m.textContent,b.value=v.textContent,c(h,S),c(h,b),u(Array.from(h.querySelectorAll(".popup__input")),h.querySelector(".popup__button")),n(d)})),h.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=h.querySelector(".popup__button");L(!0,o),(t=S.value,n=b.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){m.textContent=e.name,v.textContent=e.about,r(d)})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){L(!1,o)}))})),d.querySelector(".popup__close").addEventListener("click",(function(){r(d)}));var q=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_new-card .popup__form"),g=k.querySelector(".popup__input_type_card-name"),E=k.querySelector(".popup__input_type_url");function L(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";t.textContent=e?n:r}function j(e,t){var r=s.cloneNode(!0),o=r.querySelector(".card__image"),c=r.querySelector(".card__title"),u=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),i=r.querySelector(".card__like-count");return o.src=e.link,o.alt=e.name,c.textContent=e.name,i.textContent=e.likes.length,e.owner._id!==t?u.remove():u.addEventListener("click",(function(){var t;(t=e._id,function(e){return fetch("".concat(p.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t)).then((function(){return r.remove()})).catch((function(e){return console.error("Ошибка удаления карточки:",e)}))})),e.likes.some((function(e){return e._id===C}))&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){var t;a.classList.contains("card__like-button_is-active")?(t=e._id,fetch("".concat(p.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){a.classList.remove("card__like-button_is-active"),i.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка снятия лайка:",e)})):function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id).then((function(e){a.classList.add("card__like-button_is-active"),i.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка постановки лайка:",e)}))})),o.addEventListener("click",(function(){var t=f.querySelector(".popup__image"),r=f.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,r.textContent=e.name,n(f)})),r}q.addEventListener("click",(function(){k.reset();var e=k.querySelector(".popup__input_type_card-name"),t=k.querySelector(".popup__input_type_url");o(k,e),o(k,t),u(Array.from(k.querySelectorAll(".popup__input")),k.querySelector(".popup__button")),n(_)})),k.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=k.querySelector(".popup__button");L(!0,o),(t=g.value,n=E.value,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=j(e,C);l.prepend(t),r(_),k.reset()})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){L(!1,o)}))})),_.querySelector(".popup__close").addEventListener("click",(function(){r(_)})),f.querySelector(".popup__close").addEventListener("click",(function(){r(f)}));var C="",x=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_avatar"),w=P.querySelector(".popup__form"),A=w.querySelector(".popup__input_type_avatar-link");w.querySelector(".popup__button"),fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,v.textContent=e.about,document.querySelector("#avatar-img").src=e.avatar,C=e._id})).catch((function(e){console.error("Ошибка загрузки информации о пользователе:",e)})),x.addEventListener("click",(function(){w.reset(),n(P)})),w.addEventListener("submit",(function(e){e.preventDefault();var t,n=w.querySelector(".popup__button");L(!0,n),(t=A.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.src=e.avatar,r(P),w.reset()})).catch((function(e){console.error("Ошибка обновления аватара:",e),alert("Не удалось обновить аватар")})).finally((function(){L(!1,n)}))})),P.querySelector(".popup__close").addEventListener("click",(function(){r(P)})),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=j(e,C);l.append(t)}))})).catch((function(e){console.error("Ошибка загрузки карточек:",e)}))})();